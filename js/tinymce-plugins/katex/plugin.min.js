tinymce.PluginManager.add('katex', function(editor, url) {
    editor.ui.registry.addButton('katex', {
        text: 'KaTeX Equation',
        onAction: function() {
            editor.windowManager.open({
                title: 'Insert KaTeX Equation',
                body: {
                    type: 'textarea',
                    name: 'equation',
                    label: 'LaTeX Equation'
                },
                buttons: [
                    {
                        type: 'cancel',
                        text: 'Cancel'
                    },
                    {
                        type: 'submit',
                        text: 'Insert',
                        primary: true
                    }
                ],
                onSubmit: function(api) {
                    const equation = api.getData().equation;
                    editor.insertContent('<span class="katex-equation">' + equation + '</span>');
                    api.close();
                }
            });
        }
    });
});